<!DOCTYPE html>
<html>
<head>
    <title>Programas de Subsidios - Beneficiarios</title>
</head>
<body>
    <?php
        // Conexi칩n a la base de datos
        $pdo = new PDO('sqlite:examen3.db');
        
        // Obtener la lista de beneficiarios
        $stmt = $pdo->query('SELECT * FROM beneficiarios ORDER BY id');
        $beneficiarios = $stmt->fetchAll(PDO::FETCH_ASSOC);
        
        // Obtener el ID del beneficiario a editar, si se proporcion칩
        $id = $_GET['id'] ?? null;
        
        // Obtener los datos del beneficiario, si existe el ID
        $beneficiario = null;
        if ($id) {
            $stmt = $pdo->prepare('SELECT * FROM beneficiarios WHERE id = :id');
            $stmt->execute(['id' => $id]);
            $beneficiario = $stmt->fetch(PDO::FETCH_ASSOC);
        }
        
        // Si se envi칩 el formulario, guardar los datos en la base de datos
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $nombre = $_POST['nombre'];
            $apellido = $_POST['apellido'];
            $id_municipio = $_POST['id_municipio'];
            $fecha_nacimiento = $_POST['fecha_nacimiento'];
            
            if ($id) {
                // Actualizar el beneficiario existente
                $stmt = $pdo->prepare('UPDATE beneficiarios SET nombre = :nombre, apellido = :apellido, id_municipio = :id_municipio, fecha_nacimiento = :fecha_nacimiento WHERE id = :id');
                $stmt->execute(['nombre' => $nombre, 'apellido' => $apellido, 'id_municipio' => $id_municipio, 'fecha_nacimiento' => $fecha_nacimiento, 'id' => $id]);
            } else {
                // Agregar un nuevo beneficiario
                $stmt = $pdo->prepare('INSERT INTO beneficiarios (nombre, apellido, id_municipio, fecha_nacimiento) VALUES (:nombre, :apellido, :id_municipio, :fecha_nacimiento)');
                $stmt->execute(['nombre' => $nombre, 'apellido' => $apellido, 'id_municipio' => $id_municipio, 'fecha_nacimiento' => $fecha_nacimiento]);
            }
            
            // Redirigir a la p치gina de beneficiarios
            header('Location: beneficiarios.php');
            exit;
        }
    ?>
    
    <h1>Programas de Subsidios - Beneficiarios</h1>
    
    <!-- Lista de beneficiarios existentes -->
    <h2>Beneficiarios existentes</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Municipio</th>
                <th>Fecha de nacimiento</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($beneficiarios as $beneficiario) { ?>
            <tr>
                <td><?php echo $beneficiario['id']; ?></td>
                <td><?php echo $beneficiario['nombre']; ?></td>
                <td><?php echo $beneficiario['apellido']; ?></td>
                <td><?php echo $beneficiario['id_municipio']; ?></td
